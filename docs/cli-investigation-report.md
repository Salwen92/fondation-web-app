# Fondation CLI Investigation Report

## 1. Executive Summary

The Fondation CLI has two distinct operational modes: a **tutorial generation system** (via the `analyze` command) that creates structured educational content through a 6-step workflow, and a **general-purpose mode** (via the `run` command) that can generate documentation based on prompts. The `analyze` command, which is the core feature for generating comprehensive courses, **fails in the bundled CLI** because it requires the `@anthropic-ai/claude-code` SDK which is not included in the bundle. The `run` command works successfully and can generate documentation, taking approximately 1-2 minutes for small projects. **For our web app's goal of generating course documentation, we should use the `run` command with appropriate prompts**, as the `analyze` command is not functional in the bundled distribution. The CLI is suitable for our goals but requires using the `run` command rather than the intended `analyze` workflow.

## 2. Command Analysis

### 2.1 `analyze` Command
**Purpose**: Orchestrates the complete 6-step tutorial generation workflow
- Extracts core abstractions from codebase
- Analyzes relationships between components  
- Determines optimal chapter ordering
- Generates chapter content
- Reviews and enhances chapters
- Creates interactive tutorials

**Status**: **NON-FUNCTIONAL** in bundled CLI due to missing `@anthropic-ai/claude-code` SDK dependency

### 2.2 `run` Command  
**Purpose**: Execute prompts in headless mode with full Claude integration
- Accepts custom prompts via `-p` flag or `-f` for file input
- Can use custom system prompts via `--system-prompt`
- Outputs results to stdout
- Works with bundled CLI
- Flexible for various documentation generation tasks

**Status**: **FULLY FUNCTIONAL**

### 2.3 `generate-chapters` Command
**Purpose**: Generate chapter content from pre-existing YAML files
- Requires three input YAML files (abstractions, relationships, chapter order)
- Part of the tutorial generation pipeline
- Cannot work standalone without the YAML files from `analyze` step

**Status**: **UNUSABLE** without prior YAML generation

### 2.4 `review-chapters` Command
**Purpose**: Review and enhance previously generated chapters
- Requires existing chapter files
- Part of the tutorial generation pipeline

**Status**: **UNUSABLE** without prior chapter generation

### 2.5 `generate-tutorials` Command
**Purpose**: Generate interactive tutorials from reviewed chapters
- Final step in the tutorial pipeline
- Requires reviewed chapter files

**Status**: **UNUSABLE** without prior steps

### 2.6 `chat` Command
**Purpose**: Interactive chat mode with Claude
- Not suitable for automated documentation generation
- Designed for interactive use

**Status**: Not tested (not relevant for automation)

### 2.7 Note on `onboard` Command
**Finding**: No `onboard` command exists in the CLI. This was a misunderstanding from the initial request.

## 3. Detailed Test Logs

### 3.1 Test: `analyze` Command

**Command Executed**: 
```bash
node dist/cli.bundled.cjs analyze /tmp/test-repo --output-dir /tmp/test-output
```

**Time to Complete**: 1.3 seconds (failed immediately)

**Console Output**:
```json
{"level":"info","time":1755954529070,"context":"analyze","msg":"Starting codebase analysis"}
{"level":"info","time":1755954529080,"context":"analyze","msg":"Extracting core abstractions from codebase"}
{"level":"error","time":1755954529430,"context":"analyze","msg":"Analysis failed"}
```

**Files Created/Modified**: None

**Failure Reason**: The command attempts to import `@anthropic-ai/claude-code` SDK which is not bundled in `cli.bundled.cjs`

### 3.2 Test: `generate-chapters` Command

**Command Executed**: 
```bash
node dist/cli.bundled.cjs generate-chapters --help
```

**Time to Complete**: 0.4 seconds (help display only)

**Console Output**: Displayed help showing requirement for YAML input files

**Files Created/Modified**: N/A (not executed due to missing prerequisites)

**Note**: This command requires YAML files that would be generated by the `analyze` command, making it unusable in our context.

### 3.3 Test: `run` Command with Documentation Prompt

**Command Executed**:
```bash
cd /tmp/test-repo && node /Users/salwen/Documents/Cyberscaling/fondation/dist/cli.bundled.cjs run -p "Analyze this codebase and generate comprehensive documentation in markdown format" --quiet
```

**Time to Complete**: 1 minute 54 seconds

**Console Output** (truncated):
```
I'll analyze the codebase and generate comprehensive documentation...
[Various tool operations]
I've created a comprehensive documentation file (`COMPREHENSIVE_DOCUMENTATION.md`) that includes:
- Project Overview
- Repository Structure  
- Core Components
- API Reference
- Usage Examples
[...]
```

**Files Created/Modified**:
- Created: `/tmp/test-repo/COMPREHENSIVE_DOCUMENTATION.md` (17,263 bytes)
- Modified: `/tmp/test-repo/README.md`

### 3.4 Test: `run` Command with System Prompt

**Command Executed**:
```bash
cd /tmp/test-repo && node /Users/salwen/Documents/Cyberscaling/fondation/dist/cli.bundled.cjs run --system-prompt /Users/salwen/Documents/Cyberscaling/fondation/prompts/general.md -p "generate documentation for this project" --quiet
```

**Time to Complete**: 50 seconds

**Console Output** (truncated):
```
I'll help you generate documentation for this project!
[Various tool operations]
Perfect! I've enhanced your existing README.md with comprehensive documentation...
```

**Files Created/Modified**:
- Modified: `/tmp/test-repo/README.md` (expanded from 657 bytes to ~6KB with comprehensive content)

**Behavior Note**: With the general.md system prompt, the CLI acts as a mentor/assistant and tends to enhance existing files rather than create new comprehensive documentation files.

## 4. Difficulties & CLI Issues

### 4.1 Critical Issue: `analyze` Command Failure
- **Problem**: The main tutorial generation command fails immediately
- **Root Cause**: Missing `@anthropic-ai/claude-code` SDK in bundled distribution
- **Impact**: Cannot use the intended 6-step tutorial generation workflow

### 4.2 Dependency Chain Broken
- **Problem**: Commands like `generate-chapters`, `review-chapters`, and `generate-tutorials` require outputs from `analyze`
- **Impact**: The entire tutorial generation pipeline is unusable

### 4.3 No Clear Documentation Mode
- **Problem**: The `run` command with general.md prompt acts as a mentor rather than a pure documentation generator
- **Impact**: Behavior varies based on prompt and system prompt combination

### 4.4 Output Inconsistency
- **Problem**: Depending on the prompt, the CLI either creates new files or modifies existing ones
- **Impact**: Difficult to predict output location and format for automation

### 4.5 Long Execution Times
- **Observation**: Even for a tiny 2-file test repository, documentation generation takes 50-114 seconds
- **Impact**: May timeout for larger codebases in production environments

## 5. Recommended Workflow for the Web App

Based on this investigation, here is the **definitive command** our Cloud Run server should execute:

### Primary Recommendation:

```bash
cd <repository_path> && node <fondation_cli_path>/dist/cli.bundled.cjs run -p "Analyze this codebase and generate comprehensive documentation. Create a detailed markdown document that includes: 1) Project overview and architecture, 2) Installation and setup instructions, 3) Complete API documentation with examples, 4) Usage guides and tutorials, 5) Configuration options, 6) Testing procedures, 7) Contributing guidelines. Output everything in a single, well-structured markdown format." --quiet
```

### Key Configuration Points:

1. **Use the `run` command** - It's the only functional option for documentation generation
2. **Provide explicit, detailed prompts** - The output quality depends heavily on prompt specificity
3. **Use `--quiet` flag** - Reduces noise in logs while still capturing the documentation output
4. **Set appropriate timeouts** - Allow at least 3-5 minutes for execution
5. **Capture stdout** - The documentation is output to stdout, not saved to files by default

### Alternative for Enhanced Control:

If you want the CLI to create files directly, modify the prompt to include file operations:
```bash
"...generate comprehensive documentation and save it to a file named DOCUMENTATION.md in the current directory"
```

### Not Recommended:
- Do not attempt to use `analyze` command with bundled CLI
- Do not rely on system prompts like general.md for consistent documentation output
- Do not use the generate-chapters/review-chapters commands without the full pipeline

## Conclusion

The Fondation CLI can achieve our documentation generation goals, but not through its intended tutorial generation system. The `run` command with carefully crafted prompts provides a workable solution for generating comprehensive documentation, though it lacks the structured educational focus of the original `analyze` workflow. For production use, consider either bundling the Claude Code SDK properly or accepting the limitations of the `run` command approach.