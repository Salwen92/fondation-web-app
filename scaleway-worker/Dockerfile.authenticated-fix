FROM scaleway-worker:authenticated-final

# Install Express (not present in authenticated image)
USER root
WORKDIR /scaleway
RUN npm install express

# Copy the updated server.js with callback fix
COPY server.js /scaleway/worker/

# Ensure correct ownership
RUN chown -R scaleway:scaleway /scaleway
USER scaleway

# Keep the same entrypoint
ENTRYPOINT ["node", "/scaleway/worker/server.js"]